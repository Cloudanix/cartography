{
    "statements": [
        {
            "query": "MATCH ((n:AzureNetworkInterface)<-[:RESOURCE]-(:AzureSubscription{id: $AZURE_SUBSCRIPTION_ID})<-[:RESOURCE]-(:AzureTenant{id: $AZURE_TENANT_ID})<-[:OWNER]-(:CloudanixWorkspace{id: $WORKSPACE_ID})) where EXISTS(n.exposed_internet) WITH n LIMIT $LIMIT_SIZE REMOVE n.exposed_internet, n.exposed_internet_type return COUNT(*) as TotalCompleted",
            "iterative": true,
            "iterationsize": 100
        },
        {
            "query": "MATCH (:AzurePublicIPAddress)<-[:MEMBER_PUBLIC_IP_ADDRESS]-(interface:AzureNetworkInterface)<-[:RESOURCE]-(:AzureSubscription{id: $AZURE_SUBSCRIPTION_ID})<-[:RESOURCE]-(:AzureTenant{id: $AZURE_TENANT_ID})<-[:OWNER]-(:CloudanixWorkspace{id: $WORKSPACE_ID}) SET interface.exposed_internet = true, (CASE WHEN NOT 'public_ip' IN coalesce(interface.exposed_internet_type , []) THEN interface END).exposed_internet_type = coalesce(interface.exposed_internet_type , []) + 'public_ip';",
            "iterative": false
        },
        {
            "query": "MATCH (rule:AzureNetworkSecurityRule)<-[:CONTAIN]-(group:AzureNetworkSecurityGroup)<-[:MEMBER_NETWORK_SECURITY_GROUP]-(interface:AzureNetworkInterface)<-[:RESOURCE]-(:AzureSubscription{id: $AZURE_SUBSCRIPTION_ID})<-[:RESOURCE]-(:AzureTenant{id: $AZURE_TENANT_ID})<-[:OWNER]-(:CloudanixWorkspace{id: $WORKSPACE_ID}) WHERE rule.access='Allow' AND rule.source_address_prefix IN ['0.0.0.0/0', '::/0', '*', 'Internet'] SET interface.exposed_internet = true, (CASE WHEN NOT 'public_interface_nsg' IN coalesce(interface.exposed_internet_type , []) THEN interface END).exposed_internet_type = coalesce(interface.exposed_internet_type , []) + 'public_interface_nsg';",
            "iterative": false
        }, 
        {
            "query": "MATCH (rule:AzureNetworkSecurityRule)<-[:CONTAIN]-(group:AzureNetworkSecurityGroup)<-[:MEMBER_NETWORK_SECURITY_GROUP]-(:AzureNetworkSubnet)<-[:SUBNET]-(interface:AzureNetworkInterface)<-[:RESOURCE]-(:AzureSubscription{id: $AZURE_SUBSCRIPTION_ID})<-[:RESOURCE]-(:AzureTenant{id: $AZURE_TENANT_ID})<-[:OWNER]-(:CloudanixWorkspace{id: $WORKSPACE_ID}) WHERE rule.access='Allow' AND rule.source_address_prefix IN ['0.0.0.0/0', '::/0', '*', 'Internet'] SET interface.exposed_internet = true, (CASE WHEN NOT 'public_interface_subnet' IN coalesce(interface.exposed_internet_type , []) THEN interface END).exposed_internet_type = coalesce(interface.exposed_internet_type , []) + 'public_interface_subnet';",
            "iterative": false
        }
    ],
    "name": "Azure network interface asset internet exposure"
}